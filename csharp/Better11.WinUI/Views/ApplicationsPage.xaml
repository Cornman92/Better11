<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Better11.WinUI.Views.ApplicationsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock 
            Grid.Row="0"
            Text="Applications"
            Style="{StaticResource TitleLargeTextBlockStyle}"
            Margin="0,0,0,16"/>

        <!-- Search and Filter Bar -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <AutoSuggestBox 
                Grid.Column="0"
                PlaceholderText="Search applications..."
                QueryIcon="Find"
                Text="{x:Bind ViewModel.SearchText, Mode=TwoWay}"
                Margin="0,0,12,0"/>

            <ComboBox 
                Grid.Column="1"
                Header="Filter"
                SelectedIndex="{x:Bind ViewModel.SelectedFilterIndex, Mode=TwoWay}"
                MinWidth="150"
                Margin="0,0,12,0">
                <ComboBoxItem Content="All"/>
                <ComboBoxItem Content="Installed"/>
                <ComboBoxItem Content="Available"/>
                <ComboBoxItem Content="Updates Available"/>
            </ComboBox>

            <Button 
                Grid.Column="2"
                Content="Refresh"
                Command="{x:Bind ViewModel.RefreshCommand}">
                <Button.Icon>
                    <FontIcon Glyph="&#xE72C;"/>
                </Button.Icon>
            </Button>
        </Grid>

        <!-- Applications List -->
        <ScrollViewer Grid.Row="2">
            <ItemsRepeater ItemsSource="{x:Bind ViewModel.FilteredApplications, Mode=OneWay}">
                <ItemsRepeater.Layout>
                    <UniformGridLayout 
                        MinItemWidth="400" 
                        MinItemHeight="140"
                        ItemsStretch="Fill"
                        MinColumnSpacing="12"
                        MinRowSpacing="12"/>
                </ItemsRepeater.Layout>
                
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <Border 
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- App Name -->
                                <TextBlock 
                                    Grid.Row="0"
                                    Text="{Binding Name}"
                                    Style="{StaticResource SubtitleTextBlockStyle}"
                                    TextWrapping="NoWrap"
                                    TextTrimming="CharacterEllipsis"/>

                                <!-- Version and Status -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4,0,8">
                                    <TextBlock Text="{Binding Version}" Opacity="0.7" FontSize="12"/>
                                    <Border 
                                        Background="{StaticResource SuccessBrush}"
                                        CornerRadius="4"
                                        Padding="6,2"
                                        Margin="8,0,0,0"
                                        Visibility="{Binding IsInstalled}">
                                        <TextBlock Text="Installed" Foreground="White" FontSize="11"/>
                                    </Border>
                                </StackPanel>

                                <!-- Description -->
                                <TextBlock 
                                    Grid.Row="2"
                                    Text="{Binding Description}"
                                    TextWrapping="Wrap"
                                    Opacity="0.7"
                                    FontSize="13"
                                    MaxLines="2"/>

                                <!-- Actions -->
                                <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8" Margin="0,12,0,0">
                                    <Button
                                        Content="Plan"
                                        Command="{Binding PlanCommand}"
                                        Visibility="{Binding IsNotInstalled}">
                                        <Button.Icon>
                                            <FontIcon Glyph="&#xE81E;"/>
                                        </Button.Icon>
                                    </Button>
                                    <Button
                                        Content="Install"
                                        Command="{Binding InstallCommand}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        Visibility="{Binding IsNotInstalled}"/>
                                    <Button
                                        Content="Uninstall"
                                        Command="{Binding UninstallCommand}"
                                        Visibility="{Binding IsInstalled}"/>
                                    <Button
                                        Content="Update"
                                        Command="{Binding UpdateCommand}"
                                        Visibility="{Binding HasUpdate}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
        </ScrollViewer>

        <!-- Loading Indicator -->
        <ProgressRing 
            Grid.Row="2"
            IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
            Width="60"
            Height="60"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"/>
    </Grid>
</Page>
